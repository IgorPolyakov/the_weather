<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>The Weather</title>
    <link rel="shortcut icon" href="img/favicon.ico" type="image/x-icon">
    <!-- Bootstrap -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/weather.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <!--Some charts library-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.4.0/Chart.min.js"></script>
</head>
<body>
<nav class="navbar navbar-default">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
            <a class="navbar-brand" href="#">The Weather</a>
        </div>
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <div class="col-sm-6 col-md-6">
                <form class="navbar-form" role="search">
                    <div class="input-group">
                        <input type="text" class="form-control" placeholder="Search" name="q">
                        <div class="input-group-btn">
                            <button class="btn btn-default" type="submit"><i class="glyphicon glyphicon-search"></i></button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div><!-- /.container-fluid -->
</nav>
<div class="container">

    <div class="panel panel-default">
        <div class="panel-heading">
            <h3 class="panel-title pull-left" id="info">
                Some location
            </h3>

            <button class="btn btn-default pull-right" onclick="getWeather();">Get Weather</button>
            <div class="clearfix" ></div>
        </div>
        <div class="panel-body">
            <p id="demo">
                <canvas id="myChart" width="200" height="100"></canvas>
            </p>
        </div>
        <div class="panel-footer">
            <div class="row">
                <div id="small-img" class="col-xs-12 col-sm-12 col-md-12 col-lg-12 center">
                    <ul>
                        <li>
                            <img src="img/Null.png" id="first" class="img-responsive inline-block" alt="Responsive image" />
                        </li>
                        <li>
                            <img src="img/Null.png" id="second" class="img-responsive inline-block" alt="Responsive image" />
                        </li>
                        <li>
                            <img src="img/Null.png" id="third" class="img-responsive inline-block" alt="Responsive image" />
                        </li>
                        <li>
                            <img src="img/Null.png" id="four" class="img-responsive inline-block" alt="Responsive image" />
                        </li>
                        <li>
                            <img src="img/Null.png" id="fifth" class="img-responsive inline-block" alt="Responsive image" />
                        </li>
                        <li>
                            <img src="img/Null.png" id="six" class="img-responsive inline-block" alt="Responsive image" />
                        </li>
                        <li>
                            <img src="img/Null.png" id="seven" class="img-responsive inline-block" alt="Responsive image" />
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    function drawStatusWeather(condition_array){
//        for(var i = 0; i < condition_array.length; i++ ){
//            document.getElementById("info").src = condition_array;
//        }
        document.getElementById("first").src = "img/" + condition_array[0] + ".png";
        document.getElementById("second").src = "img/" + condition_array[1] + ".png";
        document.getElementById("third").src = "img/" + condition_array[2] + ".png";
        document.getElementById("four").src = "img/" + condition_array[3] + ".png";
        document.getElementById("fifth").src = "img/" + condition_array[4] + ".png";
        document.getElementById("six").src = "img/" + condition_array[5] + ".png";
        document.getElementById("seven").src = "img/" + condition_array[6] + ".png";
    };
    function drawWeather(some_data, day_array) {
        console.log(some_data);
        var ctx = document.getElementById("myChart");
        var myChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: day_array, //["Red", "Blue", "Yellow", "Green", "Purple", "Orange", "Yellow", "Green", "Purple", "Orange"],
                datasets: [{
                    label: '# weather',
                    data: some_data,//[12, 19, 3, 5, 2, 3],
//                    backgroundColor: [
//                        'rgba(255, 99, 132, 0.2)',
//                        'rgba(54, 162, 235, 0.2)',
//                        'rgba(255, 206, 86, 0.2)',
//                        'rgba(75, 192, 192, 0.2)',
//                        'rgba(153, 102, 255, 0.2)',
//                        'rgba(255, 159, 64, 0.2)'
//                    ],
//                    borderColor: [
//                        'rgba(255,99,132,1)',
//                        'rgba(54, 162, 235, 1)',
//                        'rgba(255, 206, 86, 1)',
//                        'rgba(75, 192, 192, 1)',
//                        'rgba(153, 102, 255, 1)',
//                        'rgba(255, 159, 64, 1)'
//                    ],
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    yAxes: [{
                        ticks: {
                            beginAtZero:true
                        }
                    }]
                }
            }
        });
    }
</script>
<script>
    function getWeather() {
        var locationUrl = 'https://query.yahooapis.com/v1/public/yql?q=select%20*%20from%20weather.forecast%20where%20woeid%20in%20(select%20woeid%20from%20geo.places(1)%20where%20text%3D%22nome%2C%20ak%22)&format=json&env=store%3A%2F%2Fdatatables.org%2Falltableswithkeys'
        var xhttp = new XMLHttpRequest();
        var result = '';
        var text = '';
        var data_forecast = '';

        xhttp.onreadystatechange = function() {
            if (this.readyState == 4 && this.status == 200) {
                if(this.responseText) {
                    try {
                        result = JSON.parse(this.responseText);
                        data_forecast = result.query.results.channel.item.forecast;
                        document.getElementById("info").innerHTML = result.query.results.channel.title;
                        parseWeather(data_forecast);
                    } catch(e) {
                        alert('Try again, Yahoo is not answer'); // error in the above string (in this case, yes)!
                    }
                }
            }
        };
        xhttp.open('get', locationUrl, true);
        xhttp.send();
    };
    function parseWeather(data_forecast) {
        var weather_array = [];
        var day_array = [];
        var condition_array = [];
        for (var i = 0; i < 7; i++) { //data_forecast.length; i++) {
            weather_array.push(data_forecast[i].low);
            day_array.push(data_forecast[i].day);
            condition_array.push(data_forecast[i].text);
        }
        drawWeather(weather_array, day_array);
        drawStatusWeather(condition_array);
    }
</script>

<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="js/bootstrap.min.js"></script>
</body>
</html>
